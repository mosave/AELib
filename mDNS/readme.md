## Аноносирование MQTT брокера с помощью сервиса mDNS

Обеспечить резервирование WiFi роутера достаточно просто. При его выходе из строя или апгрейде достаточно 
настроить на новом роутере ту же самую WiFi сеть (SSID и пароль) и IoT устройства сами подключатся к новому роутеру. 
Сценарии горячего резервирования тоже не вызывают особых сложностей.


Несколько сложнее обстоит дело с MQTT брокером, который так же необходим для нормального функционирования устройств.
MQTT брокер можно установить непосредственно на сам роутер (например, это позволяют прошивки OpenWRT и Keenetic)
Или в качестве адреса брокера в config.h прописать не P адрес а его dns имя.

Однако более гибкий и универсальный вариант - анонсирование MQTT брокера в локальной сети с помощью сервиса mDNS 
(он же Bonjur, он же ZeroConf, он же RendezVous, он же Жора, он же Гога...). 
mDNS сервис можно установить на том же роутере или сервере на котором работает MQTT брокер) установить и настроить mDNS сервис.

Инструкций по установке avahi, mDNSResponder, Bonjur, ZeroConf в интернете достаточно. 
Тем не менее я продублирую здесь описание процедуры настройки avahi, самого популярного mDNS сервиса.

Установить сервис на OperWRT роутер можно через web-интерфейс роутера:

```System => Software => Update Lists => Available => установить пакет avahi-dbus-daemon```

Установить сервис на unix системе с системой управления пакетов apt (debian, ubuntu...)

```sudo apt install avahi-daemon```

После установки avahi необходимо создать описание сервиса анонсирования mqtt.
Для этого создайте файл 
[/etc/avahi/services/mqtt.service](https://github.com/mosave/AELib/blob/main/mDNS/mqtt.service)
со следующим содержанием:


```
<?xml version="1.0"?>
<service-group>
    <name>MQTT Broker on House</name>
    <service>
        <type>_mqtt._tcp</type>
        <port>1883</port>
        <!--host-name>mosquitto</host-name-->
    </service>
</service-group>
```

Если сервис должен анонсировать MQTT брокер, установленный на другом сервере, то в приведенном выше примере необходимо
убрать комментарии с параметра "host-name" а в файле 

[/etc/avahi/hosts](https://github.com/mosave/AELib/blob/main/mDNS/hosts)

определить IP адрес, соответствующий имени хоста **mosquitto**.


